<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç«™å¯¼èˆª</title>
    <link rel="icon" href="./favicon.png" type="image/png">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="container">
        <canvas id="tsparticles"></canvas>
        <div id="content" class="content">
            <header>
                <div class="search-container">
                    <form id="search-form" class="search-form" action="" method="get" target="_blank">
                        <div class="search-input-container">
                            <input type="text" id="search-input" class="search-input" placeholder="è¾“å…¥æœç´¢å†…å®¹..." name="q">
                            <div class="search-engines">
                                <label class="search-engine-option">
                                    <input type="radio" name="search-engine" value="baidu" checked>
                                    <span>ç™¾åº¦</span>
                                </label>
                                <label class="search-engine-option">
                                    <input type="radio" name="search-engine" value="google">
                                    <span>è°·æ­Œ</span>
                                </label>
                            </div>
                            <button type="submit" class="search-button">æœç´¢</button>
                        </div>
                    </form>
                </div>
            </header>
            
            <div id="nav-container" class="categories-container">
                <!-- å¯¼èˆªå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å¼•å…¥é…ç½®æ–‡ä»¶ -->
    <script src="config.js"></script>
    
    <script>
        // éšæœºå›¾æ ‡å­—ç¬¦æ•°ç»„
        const iconChars = ['ğŸŒ', 'ğŸ”', 'ğŸ“', 'ğŸ“š', 'ğŸ®', 'ğŸ¬', 'ğŸµ', 'ğŸ“±', 'ğŸ’»', 'ğŸ› ï¸', 'ğŸ”§', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ ', 'ğŸŒŸ'];
        
        // è·å–éšæœºå›¾æ ‡å­—ç¬¦
        function getRandomIconChar() {
            return iconChars[Math.floor(Math.random() * iconChars.length)];
        }
        
        // æŒ‰æ‹¼éŸ³æ’åºå‡½æ•°
        function sortByPinyin(a, b) {
            return a.name.localeCompare(b.name, 'zh-CN');
        }

        function initTsParticles(){
            // åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ
            (async () => {
                await loadBigCirclesPreset(tsParticles);
            
                // æ ¹æ®è®¾å¤‡ç±»å‹ç¡®å®šç²’å­æ•°é‡
                const isMobile = window.innerWidth <= 768;
                const particleCount = isMobile ? 10 : 30;

                await tsParticles.load({
                    id: "tsparticles",
                    options: {
                        preset: "bigCircles",
                        particles: {
                            move: {
                                speed: 0.5, // è°ƒæ•´ç²’å­ç§»åŠ¨é€Ÿåº¦
                                outModes: {
                                    default: "bounce"
                                },
                                // ç¡®ä¿ç²’å­åˆå§‹ä½ç½®éšæœºåˆ†å¸ƒ
                                random: true,
                                enable: true
                            },
                            number: {
                                value: particleCount // æ ¹æ®è®¾å¤‡ç±»å‹è®¾ç½®ç²’å­æ•°é‡
                            },
                            size: {
                                value: { min: 50, max: 150 } // å°†åœ†å½¢å°ºå¯¸ç¼©å°ä¸€åŠ
                            },
                            opacity: {
                                value: { min: 0.1, max: 0.5 } // ä¿æŒä¸é€æ˜åº¦
                            }
                        },
                        background: {
                            color: "#f5f5f5" // ä¿æŒä¸bodyèƒŒæ™¯è‰²ä¸€è‡´
                        }
                    }
                });

                // è·å–ç²’å­å®¹å™¨å¹¶æ‰‹åŠ¨åˆ†æ•£ç²’å­
                setTimeout(() => {
                    const container = tsParticles.domItem(0);
                    if (container && container.particles && container.particles.array) {
                        const width = window.innerWidth;
                        const height = window.innerHeight;

                        container.particles.array.forEach(particle => {
                            // éšæœºè®¾ç½®ç²’å­ä½ç½®
                            particle.position.x = Math.random() * width;
                            particle.position.y = Math.random() * height;
                        });
                    }
                }, 100);
            })();

            var tsParticlesDiv = document.getElementById("tsparticles");
            if (tsParticlesDiv) {
                tsParticlesDiv.style.zIndex = "-1";
            }
            var contentDiv = document.getElementById("content");
            if (contentDiv) {
                contentDiv.style.zIndex = "1";
                contentDiv.style.position = "relative";
            }
        }
        
        // å¤„ç†æœç´¢è¡¨å•æäº¤
        function setupSearchForm() {
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');

            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const searchEngine = document.querySelector('input[name="search-engine"]:checked').value;
                const searchTerm = searchInput.value.trim();

                if (searchTerm) {
                    let searchUrl = '';

                    if (searchEngine === 'baidu') {
                        searchUrl = `https://www.baidu.com/s?wd=${encodeURIComponent(searchTerm)}`;
                    } else if (searchEngine === 'google') {
                        searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}`;
                    }

                    window.open(searchUrl, '_blank');
                } else {
                    alert('æœç´¢è¯ä¸ºç©º');
                }
            });

            // æ·»åŠ å…¨å±€é”®ç›˜äº‹ä»¶ç›‘å¬ï¼ŒæŒ‰ä¸‹Enteré”®æ—¶å‘èµ·æœç´¢
            document.addEventListener('keydown', function(e) {
                // å¦‚æœæŒ‰ä¸‹çš„æ˜¯Enteré”®ï¼Œå¹¶ä¸”å½“å‰æ²¡æœ‰åœ¨è¾“å…¥æ¡†ä¸­
                if (e.key === 'Enter' && document.activeElement !== searchInput) {
                    // èšç„¦åˆ°æœç´¢æ¡†
                    searchInput.focus();

                    // å¦‚æœæœç´¢æ¡†ä¸­æœ‰å†…å®¹ï¼Œåˆ™æäº¤è¡¨å•
                    if (searchInput.value.trim()) {
                        searchForm.dispatchEvent(new Event('submit'));
                    } else {
                        alert('æœç´¢è¯ä¸ºç©º');
                    }
                }
            });
        }

        // å¤„ç†å¹¶æ˜¾ç¤ºå¯¼èˆªæ•°æ®
        function processNavData() {
            // æŒ‰åˆ†ç±»åˆ†ç»„
            const categoryMap = {};
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦åœ¨å†…ç½‘ç¯å¢ƒ
            const currentUrl = window.location.href;
            const isInternalNetwork = internalNetworkPatterns && internalNetworkPatterns.some(pattern => currentUrl.includes(pattern));

            navConfig.forEach(site => {
                const name = site[0];
                const url = site[1];
                const internalUrl = site[2] || "";
                const category = site[3] || "å…¶ä»–"; // å¦‚æœæ²¡æœ‰åˆ†ç±»ï¼Œé»˜è®¤ä¸º"å…¶ä»–"
                const order = site[4];
                const icon = site[5] || "";

                // æ ¹æ®å½“å‰ç¯å¢ƒé€‰æ‹©åˆé€‚çš„URL
                let actualUrl = url;
                if (isInternalNetwork && internalUrl) {
                    actualUrl = internalUrl;
                }

                if (!categoryMap[category]) {
                    categoryMap[category] = [];
                }

                // åˆ¤æ–­æ˜¯å¦ä¸ºå†…ç½‘URL
                const isInternalUrl = internalNetworkPatterns && internalNetworkPatterns.some(pattern => actualUrl.includes(pattern));

                categoryMap[category].push({
                    name,
                    url: actualUrl,
                    originalUrl: url,
                    internalUrl,
                    category,
                    order,
                    icon,
                    isInternalUrl
                });
            });
            
            // è·å–å¯¼èˆªå®¹å™¨
            const navContainer = document.getElementById('nav-container');
            
            // éå†åˆ†ç±»
            for (const category in categoryMap) {
                const sites = categoryMap[category];
                
                // åˆ†ç±»å†…æ’åºï¼šå…ˆæŒ‰orderæ’åºï¼Œæ²¡æœ‰orderçš„æŒ‰æ‹¼éŸ³æ’åº
                const sitesWithOrder = sites.filter(site => site.order !== undefined && site.order !== null && site.order !== "");
                const sitesWithoutOrder = sites.filter(site => site.order === undefined || site.order === null || site.order === "");
                
                // æœ‰åºå·çš„æŒ‰åºå·æ’åº
                sitesWithOrder.sort((a, b) => a.order - b.order);
                
                // æ— åºå·çš„æŒ‰æ‹¼éŸ³æ’åº
                sitesWithoutOrder.sort(sortByPinyin);
                
                // åˆå¹¶æ’åºåçš„æ•°ç»„
                const sortedSites = [...sitesWithOrder, ...sitesWithoutOrder];
                
                // åˆ›å»ºåˆ†ç±»åŒºåŸŸ
                const categorySection = document.createElement('div');
                categorySection.className = 'category-section';
                
                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜
                const categoryTitle = document.createElement('h2');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = category;
                categorySection.appendChild(categoryTitle);
                
                // åˆ›å»ºç½‘ç«™ç½‘æ ¼
                const siteGrid = document.createElement('div');
                siteGrid.className = 'site-grid';
                
                // æ·»åŠ ç½‘ç«™å¡ç‰‡
                sortedSites.forEach(site => {
                    // åˆ›å»ºç½‘ç«™é“¾æ¥
                    const siteLink = document.createElement('a');
                    siteLink.className = 'site-card';
                    siteLink.href = site.url;
                    siteLink.target = '_blank';
                    
                    // æ ¹æ®URLç±»å‹è®¾ç½®æ ·å¼
                    const hostname = new URL(site.url).hostname;
                    if (site.isInternalUrl) {
                        // å†…ç½‘åœ°å€ä½¿ç”¨é»˜è®¤æ ·å¼
                    } else if (vip1Domains && vip1Domains.some(domain => hostname.includes(domain))) {
                        siteLink.classList.add('vip1');
                    } else if (vip2Domains && vip2Domains.some(domain => hostname.includes(domain))) {
                        siteLink.classList.add('vip2');
                    } else {
                        siteLink.classList.add('external');
                    }

                    // åˆ›å»ºç½‘ç«™å›¾æ ‡
                    if (site.icon && site.icon.trim() !== '') {
                        // æœ‰å›¾æ ‡URL
                        const iconImg = document.createElement('img');
                        iconImg.className = 'site-icon';
                        iconImg.src = site.icon;
                        iconImg.alt = site.name;
                        iconImg.onerror = function() {
                            // å›¾æ ‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºéšæœºå­—ç¬¦
                            this.outerHTML = `<div class="site-icon">${getRandomIconChar()}</div>`;
                        };
                        siteLink.appendChild(iconImg);
                    } else {
                        // æ²¡æœ‰å›¾æ ‡ï¼Œå°è¯•è·å–ç½‘ç«™çš„favicon
                        const siteUrl = new URL(site.url);
                        const origin = siteUrl.origin;

                        // åˆ›å»ºå›¾æ ‡å…ƒç´ 
                        const iconImg = document.createElement('img');
                        iconImg.className = 'site-icon';
                        iconImg.alt = site.name;

                        // å°è¯•å¤šç§å¸¸è§çš„faviconè·¯å¾„
                        const tryFaviconPaths = [
                            `${origin}/favicon.png`,
                            `${origin}/favicon.ico`
                        ];

                        // å°è¯•åŠ è½½ç¬¬ä¸€ä¸ªè·¯å¾„
                        iconImg.src = tryFaviconPaths[0];
                        let currentPathIndex = 0;

                        // å½“å›¾æ ‡åŠ è½½å¤±è´¥æ—¶ï¼Œå°è¯•ä¸‹ä¸€ä¸ªè·¯å¾„
                        iconImg.onerror = function() {
                            currentPathIndex++;
                            // å¦‚æœè¿˜æœ‰è·¯å¾„å¯ä»¥å°è¯•
                            if (currentPathIndex < tryFaviconPaths.length) {
                                this.src = tryFaviconPaths[currentPathIndex];
                            } else {
                                // æ‰€æœ‰è·¯å¾„éƒ½å¤±è´¥ï¼Œæ˜¾ç¤ºéšæœºå­—ç¬¦
                                this.outerHTML = `<div class="site-icon">${getRandomIconChar()}</div>`;
                            }
                        };

                        siteLink.appendChild(iconImg);
                    }
                    
                    // åˆ›å»ºç½‘ç«™åç§°
                    const siteName = document.createElement('div');
                    siteName.className = 'site-name';
                    siteName.textContent = site.name;
                    siteLink.appendChild(siteName);
                    
                    // åˆ›å»ºç½‘ç«™URL
                    const siteUrl = document.createElement('div');
                    siteUrl.className = 'site-url';
                    siteUrl.textContent = new URL(site.url).hostname;
                    siteLink.appendChild(siteUrl);
                    
                    // æ·»åŠ åˆ°ç½‘æ ¼
                    siteGrid.appendChild(siteLink);
                });
                
                // æ·»åŠ ç½‘æ ¼åˆ°åˆ†ç±»åŒºåŸŸ
                categorySection.appendChild(siteGrid);
                
                // æ·»åŠ åˆ†ç±»åŒºåŸŸåˆ°å¯¼èˆªå®¹å™¨
                navContainer.appendChild(categorySection);
            }

            setupSearchForm();
            initTsParticles();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¤„ç†å¯¼èˆªæ•°æ®
        document.addEventListener('DOMContentLoaded', processNavData);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
    <script>
        // æ·»åŠ å¤§åœ†é¢„è®¾çš„å®šä¹‰ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å®ƒ
        async function loadBigCirclesPreset(engine) {
            await engine.addPreset("bigCircles", {
                particles: {
                    number: {
                        value: 15 // é»˜è®¤ç²’å­æ•°é‡ï¼Œå°†åœ¨åŠ è½½æ—¶æ ¹æ®è®¾å¤‡ç±»å‹è¦†ç›–
                    },
                    color: {
                        value: ["#3998D0", "#2EB6AF", "#A9BD33", "#FEC73B", "#F89930", "#F45623", "#D62E32", "#EB586E", "#9952CF"],
                    },
                    shape: {
                        type: "circle",
                    },
                    opacity: {
                        value: { min: 0.1, max: 0.5 }, // ä¿æŒä¸é€æ˜åº¦
                    },
                    size: {
                        value: { min: 50, max: 150 }, // å°†åœ†å½¢å°ºå¯¸ç¼©å°ä¸€åŠ
                    },
                    move: {
                        enable: true,
                        speed: 0.5, // è°ƒæ•´ç§»åŠ¨é€Ÿåº¦
                        direction: "none",
                        random: true,
                        straight: false,
                        outModes: {
                            default: "bounce",
                        },
                        attract: {
                            enable: false,
                            distance: 200,
                            duration: 0.4,
                        }
                    }
                },
                interactivity: {
                    detectsOn: "canvas",
                    events: {
                        resize: true,
                    },
                },
                detectRetina: true,
            });
        }
    </script>
</body>
</html>